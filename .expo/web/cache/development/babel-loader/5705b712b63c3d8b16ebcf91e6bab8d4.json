{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { CodedError, Platform } from 'expo-modules-core';\nimport { KeepAwakeEventState } from \"./KeepAwake.types\";\nvar wakeLockMap = {};\nexport default {\n  isAvailableAsync: function () {\n    var _isAvailableAsync = _asyncToGenerator(function* () {\n      if (Platform.isDOMAvailable) {\n        return 'wakeLock' in navigator;\n      }\n\n      return false;\n    });\n\n    function isAvailableAsync() {\n      return _isAvailableAsync.apply(this, arguments);\n    }\n\n    return isAvailableAsync;\n  }(),\n  activate: function () {\n    var _activate = _asyncToGenerator(function* (tag) {\n      if (!Platform.isDOMAvailable) {\n        return;\n      }\n\n      var wakeLock = yield navigator.wakeLock.request('screen');\n      wakeLockMap[tag] = wakeLock;\n    });\n\n    function activate(_x) {\n      return _activate.apply(this, arguments);\n    }\n\n    return activate;\n  }(),\n  deactivate: function () {\n    var _deactivate = _asyncToGenerator(function* (tag) {\n      if (!Platform.isDOMAvailable) {\n        return;\n      }\n\n      if (wakeLockMap[tag]) {\n        var _wakeLockMap$tag$rele, _wakeLockMap$tag;\n\n        (_wakeLockMap$tag$rele = (_wakeLockMap$tag = wakeLockMap[tag]).release) == null ? void 0 : _wakeLockMap$tag$rele.call(_wakeLockMap$tag);\n        delete wakeLockMap[tag];\n      } else {\n        throw new CodedError('ERR_KEEP_AWAKE_TAG_INVALID', \"The wake lock with tag \" + tag + \" has not activated yet\");\n      }\n    });\n\n    function deactivate(_x2) {\n      return _deactivate.apply(this, arguments);\n    }\n\n    return deactivate;\n  }(),\n  addListenerForTag: function addListenerForTag(tag, listener) {\n    var eventListener = function eventListener() {\n      listener({\n        state: KeepAwakeEventState.RELEASE\n      });\n    };\n\n    var sentinel = wakeLockMap[tag];\n\n    if (sentinel) {\n      if ('addEventListener' in sentinel) {\n        sentinel.addEventListener == null ? void 0 : sentinel.addEventListener('release', eventListener);\n      } else {\n        sentinel.onrelease = eventListener;\n      }\n    }\n\n    return {\n      remove: function remove() {\n        var sentinel = wakeLockMap[tag];\n\n        if (sentinel) {\n          if (sentinel.removeEventListener) {\n            sentinel.removeEventListener('release', eventListener);\n          } else {\n            sentinel.onrelease = null;\n          }\n        }\n      }\n    };\n  }\n};","map":{"version":3,"sources":["../src/ExpoKeepAwake.web.ts"],"names":[],"mappings":";AAAA,SAAS,UAAT,EAAqB,QAArB,QAAmD,mBAAnD;AAEA,SAAS,mBAAT;AAEA,IAAM,WAAW,GAAqC,EAAtD;AAmBA,eAAe;AACP,EAAA,gBADO;AAAA,2DACS;AACpB,UAAI,QAAQ,CAAC,cAAb,EAA6B;AAC3B,eAAO,cAAc,SAArB;AACD;;AACD,aAAO,KAAP;AACD,KANY;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAOP,EAAA,QAPO;AAAA,iDAOE,GAPF,EAOa;AACxB,UAAI,CAAC,QAAQ,CAAC,cAAd,EAA8B;AAC5B;AACD;;AACD,UAAM,QAAQ,SAAS,SAAS,CAAC,QAAV,CAAmB,OAAnB,CAA2B,QAA3B,CAAvB;AACA,MAAA,WAAW,CAAC,GAAD,CAAX,GAAmB,QAAnB;AACD,KAbY;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAcP,EAAA,UAdO;AAAA,mDAcI,GAdJ,EAce;AAC1B,UAAI,CAAC,QAAQ,CAAC,cAAd,EAA8B;AAC5B;AACD;;AACD,UAAI,WAAW,CAAC,GAAD,CAAf,EAAsB;AAAA;;AACpB,qDAAA,WAAW,CAAC,GAAD,CAAX,EAAiB,OAAjB;AACA,eAAO,WAAW,CAAC,GAAD,CAAlB;AACD,OAHD,MAGO;AACL,cAAM,IAAI,UAAJ,CACJ,4BADI,8BAEsB,GAFtB,4BAAN;AAID;AACF,KA3BY;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA4Bb,EAAA,iBA5Ba,6BA4BK,GA5BL,EA4BkB,QA5BlB,EA4B6C;AACxD,QAAM,aAAa,GAAG,SAAhB,aAAgB,GAAK;AACzB,MAAA,QAAQ,CAAC;AAAE,QAAA,KAAK,EAAE,mBAAmB,CAAC;AAA7B,OAAD,CAAR;AACD,KAFD;;AAGA,QAAM,QAAQ,GAAG,WAAW,CAAC,GAAD,CAA5B;;AACA,QAAI,QAAJ,EAAc;AACZ,UAAI,sBAAsB,QAA1B,EAAoC;AAClC,QAAA,QAAQ,CAAC,gBAAT,oBAAA,QAAQ,CAAC,gBAAT,CAA4B,SAA5B,EAAuC,aAAvC;AACD,OAFD,MAEO;AACL,QAAA,QAAQ,CAAC,SAAT,GAAqB,aAArB;AACD;AACF;;AACD,WAAO;AACL,MAAA,MAAM,EAAE,kBAAK;AACX,YAAM,QAAQ,GAAG,WAAW,CAAC,GAAD,CAA5B;;AACA,YAAI,QAAJ,EAAc;AACZ,cAAI,QAAQ,CAAC,mBAAb,EAAkC;AAChC,YAAA,QAAQ,CAAC,mBAAT,CAA6B,SAA7B,EAAwC,aAAxC;AACD,WAFD,MAEO;AACL,YAAA,QAAQ,CAAC,SAAT,GAAqB,IAArB;AACD;AACF;AACF;AAVI,KAAP;AAYD;AApDY,CAAf","sourcesContent":["import { CodedError, Platform, Subscription } from 'expo-modules-core';\n\nimport { KeepAwakeEventState, KeepAwakeListener } from './KeepAwake.types';\n\nconst wakeLockMap: Record<string, WakeLockSentinel> = {};\n\ntype WakeLockSentinel = {\n  onrelease: null | ((event: any) => void);\n  released: boolean;\n  type: 'screen';\n  release?: Function;\n\n  addEventListener?: (event: string, listener: (event: any) => void) => void;\n  removeEventListener?: (event: string, listener: (event: any) => void) => void;\n};\n\ndeclare const navigator: {\n  wakeLock: {\n    request(type: 'screen'): Promise<WakeLockSentinel>;\n  };\n};\n\n/** Wraps the webWakeLock API https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API */\nexport default {\n  async isAvailableAsync() {\n    if (Platform.isDOMAvailable) {\n      return 'wakeLock' in navigator;\n    }\n    return false;\n  },\n  async activate(tag: string) {\n    if (!Platform.isDOMAvailable) {\n      return;\n    }\n    const wakeLock = await navigator.wakeLock.request('screen');\n    wakeLockMap[tag] = wakeLock;\n  },\n  async deactivate(tag: string) {\n    if (!Platform.isDOMAvailable) {\n      return;\n    }\n    if (wakeLockMap[tag]) {\n      wakeLockMap[tag].release?.();\n      delete wakeLockMap[tag];\n    } else {\n      throw new CodedError(\n        'ERR_KEEP_AWAKE_TAG_INVALID',\n        `The wake lock with tag ${tag} has not activated yet`\n      );\n    }\n  },\n  addListenerForTag(tag: string, listener: KeepAwakeListener): Subscription {\n    const eventListener = () => {\n      listener({ state: KeepAwakeEventState.RELEASE });\n    };\n    const sentinel = wakeLockMap[tag];\n    if (sentinel) {\n      if ('addEventListener' in sentinel) {\n        sentinel.addEventListener?.('release', eventListener);\n      } else {\n        sentinel.onrelease = eventListener;\n      }\n    }\n    return {\n      remove: () => {\n        const sentinel = wakeLockMap[tag];\n        if (sentinel) {\n          if (sentinel.removeEventListener) {\n            sentinel.removeEventListener('release', eventListener);\n          } else {\n            sentinel.onrelease = null;\n          }\n        }\n      },\n    };\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}
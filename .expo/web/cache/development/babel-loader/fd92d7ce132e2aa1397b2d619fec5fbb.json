{"ast":null,"code":"import * as React from 'react';\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nexport default function useKeyboardManager(isEnabled) {\n  var previouslyFocusedTextInputRef = React.useRef(undefined);\n  var startTimestampRef = React.useRef(0);\n  var keyboardTimeoutRef = React.useRef();\n  var clearKeyboardTimeout = React.useCallback(function () {\n    if (keyboardTimeoutRef.current !== undefined) {\n      clearTimeout(keyboardTimeoutRef.current);\n      keyboardTimeoutRef.current = undefined;\n    }\n  }, []);\n  var onPageChangeStart = React.useCallback(function () {\n    if (!isEnabled()) {\n      return;\n    }\n\n    clearKeyboardTimeout();\n    var input = TextInput.State.currentlyFocusedInput();\n    input === null || input === void 0 ? void 0 : input.blur();\n    previouslyFocusedTextInputRef.current = input;\n    startTimestampRef.current = Date.now();\n  }, [clearKeyboardTimeout, isEnabled]);\n  var onPageChangeConfirm = React.useCallback(function (force) {\n    if (!isEnabled()) {\n      return;\n    }\n\n    clearKeyboardTimeout();\n\n    if (force) {\n      Keyboard.dismiss();\n    } else {\n      var input = previouslyFocusedTextInputRef.current;\n      input === null || input === void 0 ? void 0 : input.blur();\n    }\n\n    previouslyFocusedTextInputRef.current = undefined;\n  }, [clearKeyboardTimeout, isEnabled]);\n  var onPageChangeCancel = React.useCallback(function () {\n    if (!isEnabled()) {\n      return;\n    }\n\n    clearKeyboardTimeout();\n    var input = previouslyFocusedTextInputRef.current;\n\n    if (input) {\n      if (Date.now() - startTimestampRef.current < 100) {\n        keyboardTimeoutRef.current = setTimeout(function () {\n          input === null || input === void 0 ? void 0 : input.focus();\n          previouslyFocusedTextInputRef.current = undefined;\n        }, 100);\n      } else {\n        input === null || input === void 0 ? void 0 : input.focus();\n        previouslyFocusedTextInputRef.current = undefined;\n      }\n    }\n  }, [clearKeyboardTimeout, isEnabled]);\n  React.useEffect(function () {\n    return function () {\n      return clearKeyboardTimeout();\n    };\n  }, [clearKeyboardTimeout]);\n  return {\n    onPageChangeStart: onPageChangeStart,\n    onPageChangeConfirm: onPageChangeConfirm,\n    onPageChangeCancel: onPageChangeCancel\n  };\n}","map":{"version":3,"sources":["utils/useKeyboardManager.tsx"],"names":["React","useKeyboardManager","isEnabled","previouslyFocusedTextInputRef","useRef","undefined","startTimestampRef","keyboardTimeoutRef","clearKeyboardTimeout","useCallback","current","clearTimeout","onPageChangeStart","input","TextInput","State","currentlyFocusedInput","blur","Date","now","onPageChangeConfirm","force","Keyboard","dismiss","onPageChangeCancel","setTimeout","focus","useEffect"],"mappings":"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","sourceRoot":"../../../src","sourcesContent":["import * as React from 'react';\nimport { Keyboard, TextInput } from 'react-native';\nexport default function useKeyboardManager(isEnabled) {\n  // Numeric id of the previously focused text input\n  // When a gesture didn't change the tab, we can restore the focused input with this\n  const previouslyFocusedTextInputRef = React.useRef(undefined);\n  const startTimestampRef = React.useRef(0);\n  const keyboardTimeoutRef = React.useRef();\n  const clearKeyboardTimeout = React.useCallback(() => {\n    if (keyboardTimeoutRef.current !== undefined) {\n      clearTimeout(keyboardTimeoutRef.current);\n      keyboardTimeoutRef.current = undefined;\n    }\n  }, []);\n  const onPageChangeStart = React.useCallback(() => {\n    if (!isEnabled()) {\n      return;\n    }\n    clearKeyboardTimeout();\n    const input = TextInput.State.currentlyFocusedInput();\n\n    // When a page change begins, blur the currently focused input\n    input === null || input === void 0 ? void 0 : input.blur();\n\n    // Store the id of this input so we can refocus it if change was cancelled\n    previouslyFocusedTextInputRef.current = input;\n\n    // Store timestamp for touch start\n    startTimestampRef.current = Date.now();\n  }, [clearKeyboardTimeout, isEnabled]);\n  const onPageChangeConfirm = React.useCallback(force => {\n    if (!isEnabled()) {\n      return;\n    }\n    clearKeyboardTimeout();\n    if (force) {\n      // Always dismiss input, even if we don't have a ref to it\n      // We might not have the ref if onPageChangeStart was never called\n      // This can happen if page change was not from a gesture\n      Keyboard.dismiss();\n    } else {\n      const input = previouslyFocusedTextInputRef.current;\n\n      // Dismiss the keyboard only if an input was a focused before\n      // This makes sure we don't dismiss input on going back and focusing an input\n      input === null || input === void 0 ? void 0 : input.blur();\n    }\n\n    // Cleanup the ID on successful page change\n    previouslyFocusedTextInputRef.current = undefined;\n  }, [clearKeyboardTimeout, isEnabled]);\n  const onPageChangeCancel = React.useCallback(() => {\n    if (!isEnabled()) {\n      return;\n    }\n    clearKeyboardTimeout();\n\n    // The page didn't change, we should restore the focus of text input\n    const input = previouslyFocusedTextInputRef.current;\n    if (input) {\n      // If the interaction was super short we should make sure keyboard won't hide again.\n\n      // Too fast input refocus will result only in keyboard flashing on screen and hiding right away.\n      // During first ~100ms keyboard will be dismissed no matter what,\n      // so we have to make sure it won't interrupt input refocus logic.\n      // That's why when the interaction is shorter than 100ms we add delay so it won't hide once again.\n      // Subtracting timestamps makes us sure the delay is executed only when needed.\n      if (Date.now() - startTimestampRef.current < 100) {\n        keyboardTimeoutRef.current = setTimeout(() => {\n          input === null || input === void 0 ? void 0 : input.focus();\n          previouslyFocusedTextInputRef.current = undefined;\n        }, 100);\n      } else {\n        input === null || input === void 0 ? void 0 : input.focus();\n        previouslyFocusedTextInputRef.current = undefined;\n      }\n    }\n  }, [clearKeyboardTimeout, isEnabled]);\n  React.useEffect(() => {\n    return () => clearKeyboardTimeout();\n  }, [clearKeyboardTimeout]);\n  return {\n    onPageChangeStart,\n    onPageChangeConfirm,\n    onPageChangeCancel\n  };\n}\n//# sourceMappingURL=useKeyboardManager.js.map"]},"metadata":{},"sourceType":"module"}
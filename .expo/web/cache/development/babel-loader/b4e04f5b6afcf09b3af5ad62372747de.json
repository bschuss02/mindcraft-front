{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport { Platform } from 'expo-modules-core';\nimport PixelRatio from \"react-native-web/dist/exports/PixelRatio\";\n\nfunction getScaledAssetPath(asset) {\n  var scale = AssetSourceResolver.pickScale(asset.scales, PixelRatio.get());\n  var scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';\n  var type = !asset.type ? '' : \".\" + asset.type;\n  return asset.httpServerLocation + '/' + asset.name + scaleSuffix + type;\n}\n\nvar AssetSourceResolver = function () {\n  function AssetSourceResolver(serverUrl, jsbundleUrl, asset) {\n    _classCallCheck(this, AssetSourceResolver);\n\n    if (!serverUrl) {\n      throw new Error('Web assets require a server URL');\n    }\n\n    this.serverUrl = serverUrl;\n    this.jsbundleUrl = null;\n    this.asset = asset;\n  }\n\n  _createClass(AssetSourceResolver, [{\n    key: \"isLoadedFromServer\",\n    value: function isLoadedFromServer() {\n      return true;\n    }\n  }, {\n    key: \"isLoadedFromFileSystem\",\n    value: function isLoadedFromFileSystem() {\n      return false;\n    }\n  }, {\n    key: \"defaultAsset\",\n    value: function defaultAsset() {\n      return this.assetServerURL();\n    }\n  }, {\n    key: \"assetServerURL\",\n    value: function assetServerURL() {\n      var fromUrl = new URL(getScaledAssetPath(this.asset), this.serverUrl);\n      fromUrl.searchParams.set('platform', Platform.OS);\n      fromUrl.searchParams.set('hash', this.asset.hash);\n      return this.fromSource(fromUrl.toString());\n    }\n  }, {\n    key: \"fromSource\",\n    value: function fromSource(source) {\n      var _this$asset$width, _this$asset$height;\n\n      return {\n        __packager_asset: true,\n        width: (_this$asset$width = this.asset.width) != null ? _this$asset$width : undefined,\n        height: (_this$asset$height = this.asset.height) != null ? _this$asset$height : undefined,\n        uri: source,\n        scale: AssetSourceResolver.pickScale(this.asset.scales, PixelRatio.get())\n      };\n    }\n  }], [{\n    key: \"pickScale\",\n    value: function pickScale(scales, deviceScale) {\n      for (var i = 0; i < scales.length; i++) {\n        if (scales[i] >= deviceScale) {\n          return scales[i];\n        }\n      }\n\n      return scales[scales.length - 1] || 1;\n    }\n  }]);\n\n  return AssetSourceResolver;\n}();\n\nexport { AssetSourceResolver as default };","map":{"version":3,"sources":["../src/AssetSourceResolver.web.ts"],"names":[],"mappings":";;AAAA,SAAS,QAAT,QAAyB,mBAAzB;;;AAaA,SAAS,kBAAT,CAA4B,KAA5B,EAAiC;AAC/B,MAAM,KAAK,GAAG,mBAAmB,CAAC,SAApB,CAA8B,KAAK,CAAC,MAApC,EAA4C,UAAU,CAAC,GAAX,EAA5C,CAAd;AACA,MAAM,WAAW,GAAG,KAAK,KAAK,CAAV,GAAc,EAAd,GAAmB,MAAM,KAAN,GAAc,GAArD;AACA,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC,IAAP,GAAc,EAAd,SAAuB,KAAK,CAAC,IAA1C;AACA,SAAO,KAAK,CAAC,kBAAN,GAA2B,GAA3B,GAAiC,KAAK,CAAC,IAAvC,GAA8C,WAA9C,GAA4D,IAAnE;AACD;;IAEoB,mB;AAQnB,+BACE,SADF,EAEE,WAFF,EAGE,KAHF,EAGsB;AAAA;;AAEpB,QAAI,CAAC,SAAL,EAAgB;AACd,YAAM,IAAI,KAAJ,CAAU,iCAAV,CAAN;AACD;;AAED,SAAK,SAAL,GAAiB,SAAjB;AACA,SAAK,WAAL,GAAmB,IAAnB;AACA,SAAK,KAAL,GAAa,KAAb;AACD;;;;WAGD,8BAAkB;AAChB,aAAO,IAAP;AACD;;;WAGD,kCAAsB;AACpB,aAAO,KAAP;AACD;;;WAED,wBAAY;AACV,aAAO,KAAK,cAAL,EAAP;AACD;;;WAKD,0BAAc;AACZ,UAAM,OAAO,GAAG,IAAI,GAAJ,CAAQ,kBAAkB,CAAC,KAAK,KAAN,CAA1B,EAAwC,KAAK,SAA7C,CAAhB;AACA,MAAA,OAAO,CAAC,YAAR,CAAqB,GAArB,CAAyB,UAAzB,EAAqC,QAAQ,CAAC,EAA9C;AACA,MAAA,OAAO,CAAC,YAAR,CAAqB,GAArB,CAAyB,MAAzB,EAAiC,KAAK,KAAL,CAAW,IAA5C;AACA,aAAO,KAAK,UAAL,CAAgB,OAAO,CAAC,QAAR,EAAhB,CAAP;AACD;;;WAED,oBAAW,MAAX,EAAyB;AAAA;;AACvB,aAAO;AACL,QAAA,gBAAgB,EAAE,IADb;AAEL,QAAA,KAAK,uBAAE,KAAK,KAAL,CAAW,KAAb,gCAAsB,SAFtB;AAGL,QAAA,MAAM,wBAAE,KAAK,KAAL,CAAW,MAAb,iCAAuB,SAHxB;AAIL,QAAA,GAAG,EAAE,MAJA;AAKL,QAAA,KAAK,EAAE,mBAAmB,CAAC,SAApB,CAA8B,KAAK,KAAL,CAAW,MAAzC,EAAiD,UAAU,CAAC,GAAX,EAAjD;AALF,OAAP;AAOD;;;WAED,mBAAiB,MAAjB,EAAmC,WAAnC,EAAsD;AACpD,WAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,MAAM,CAAC,MAA3B,EAAmC,CAAC,EAApC,EAAwC;AACtC,YAAI,MAAM,CAAC,CAAD,CAAN,IAAa,WAAjB,EAA8B;AAC5B,iBAAO,MAAM,CAAC,CAAD,CAAb;AACD;AACF;;AACD,aAAO,MAAM,CAAC,MAAM,CAAC,MAAP,GAAgB,CAAjB,CAAN,IAA6B,CAApC;AACD;;;;;;SA/DkB,mB","sourcesContent":["import { Platform } from 'expo-modules-core';\nimport { PixelRatio } from 'react-native';\nimport { PackagerAsset } from 'react-native/Libraries/Image/AssetRegistry';\n\nexport type ResolvedAssetSource = {\n  __packager_asset: boolean;\n  width?: number;\n  height?: number;\n  uri: string;\n  scale: number;\n};\n\n// Returns the Metro dev server-specific asset location.\nfunction getScaledAssetPath(asset): string {\n  const scale = AssetSourceResolver.pickScale(asset.scales, PixelRatio.get());\n  const scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';\n  const type = !asset.type ? '' : `.${asset.type}`;\n  return asset.httpServerLocation + '/' + asset.name + scaleSuffix + type;\n}\n\nexport default class AssetSourceResolver {\n  serverUrl: string;\n  // where the jsbundle is being run from\n  // NOTE(EvanBacon): Never defined on web.\n  jsbundleUrl?: string | null;\n  // the asset to resolve\n  asset: PackagerAsset;\n\n  constructor(\n    serverUrl: string | undefined | null,\n    jsbundleUrl: string | undefined | null,\n    asset: PackagerAsset\n  ) {\n    if (!serverUrl) {\n      throw new Error('Web assets require a server URL');\n    }\n\n    this.serverUrl = serverUrl;\n    this.jsbundleUrl = null;\n    this.asset = asset;\n  }\n\n  // Always true for web runtimes\n  isLoadedFromServer(): boolean {\n    return true;\n  }\n\n  // Always false for web runtimes\n  isLoadedFromFileSystem(): boolean {\n    return false;\n  }\n\n  defaultAsset(): ResolvedAssetSource {\n    return this.assetServerURL();\n  }\n\n  /**\n   * @returns absolute remote URL for the hosted asset.\n   */\n  assetServerURL(): ResolvedAssetSource {\n    const fromUrl = new URL(getScaledAssetPath(this.asset), this.serverUrl);\n    fromUrl.searchParams.set('platform', Platform.OS);\n    fromUrl.searchParams.set('hash', this.asset.hash);\n    return this.fromSource(fromUrl.toString());\n  }\n\n  fromSource(source: string): ResolvedAssetSource {\n    return {\n      __packager_asset: true,\n      width: this.asset.width ?? undefined,\n      height: this.asset.height ?? undefined,\n      uri: source,\n      scale: AssetSourceResolver.pickScale(this.asset.scales, PixelRatio.get()),\n    };\n  }\n\n  static pickScale(scales: number[], deviceScale: number): number {\n    for (let i = 0; i < scales.length; i++) {\n      if (scales[i] >= deviceScale) {\n        return scales[i];\n      }\n    }\n    return scales[scales.length - 1] || 1;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}